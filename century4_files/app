typeof wtl=="undefined"&&(wtl={});typeof wtl.util=="undefined"&&(wtl.util={});$.extend(wtl.util,{_topics:{},_saveToFavoritesLock:null,_saveToFavoritesSubscriptionCallback:null,_localStorage:null,topic:function(n){var t,i=n&&this._topics[n];return i||(t=jQuery.Callbacks(),i={publish:t.fire,subscribe:t.add,unsubscribe:t.remove},n&&(this._topics[n]=i)),i},getQueryStringParameter:function(n){for(var t,u=/\+/g,f=/([^&=]+)=?([^&]*)/g,i=function(n){return decodeURIComponent(n.replace(u," "))},e=window.location.search.substring(1),r={};t=f.exec(e);)r[i(t[1])]=i(t[2]);return r[n]},popupOptions:function(n,t){return n=n||720,t=t||645,"toolbar=0,screenx="+wtl.util.suggestWinLeft(n)+",screeny="+wtl.util.suggestWinTop(t)+",location=0,directories=0,status=0,menubar=0,scrollbars=1,resizable=1,width="+n+",height="+wtl.util.suggestWinHeight(t)},showWin:function(n,t,i,r){var u=window.open(t,n,wtl.util.popupOptions(i,r));return u&&u.focus(),u},showEmailWin:function(n){return wtl.util.showWin("SendEmailWin",n,720,645)},emailAgent:function(n,t,i){var r={Type:"EmailAgent",EmailAddress:n.EmailAddress,AgentID:n.WTLUserID,CustomSubject:i||""};$.extend(r,wtl.util._getListingArgs(t));t;wtl.util._emailAction(r)},_getListingArgs:function(n){var t={};return n&&(n.ListingID>0?t.ListingID=n.ListingID:(t.MLSID=n.MLSID,t.MLSProviderID=n.MLSProviderID)),t},_emailAction:function(n){var t=[];for(var i in n)t.push(i+"="+n[i]);wtl.util.showEmailWin("/Popups/SendEmail.aspx?"+t.join("&")+"&Referrer="+location.pathname.substring(1))},suggestWinLeft:function(n){var t=wtl.util.screenWidth(),i=parseInt((t-n)/2),r=Math.floor(wtl.util.screenLeft()/t);return r>0&&(i+=t*r),i<1?1:i},suggestWinTop:function(n){var t=parseInt((wtl.util.screenHeight()-n)/2);return t<1?1:t},suggestWinHeight:function(n){return n>=wtl.util.screenHeight()*.98?parseInt(wtl.util.screenHeight()*.98):n},showMortgageCalculator:function(n,t){var i="/Popups/MortgageCalculator.aspx?Price="+n+"&ListingID="+t;wtl.util.showWin("FinancialCalcWin",i,725,720)},requestShowing:function(n,t,i,r,u,f,e,o){return wtl.util[o===undefined||o?"_propertyEmailAction":"_propertyEmailActionUrl"](n,t,i,r,u,f,e,"RequestShowing")},requestMoreInfo:function(n,t,i,r,u,f,e,o){return wtl.util[o===undefined||o?"_propertyEmailAction":"_propertyEmailActionUrl"](n,t,i,r,u,f,e,"RequestMoreInfo")},_propertyEmailActionUrl:function(n,t,i,r,u,f,e,o){var s="/Popups/SendEmail.aspx?Type="+o+"&Referrer="+location.pathname.substring(1);return r?(s+="&WorkWithAgent="+r,s+="&AgentID="+r):u?(s+="&DirectOfficeSite="+u,s+="&OfficeID="+u):f&&(s+="&DirectCompanySite="+f,s+="&CompanyID="+f),s+=n>0?"&ListingID="+n:"&MLSID="+t+"&MLSProviderID="+i,e!==undefined&&(s+="&IsContextBranded="+(e?"1":"0")),s},_propertyEmailAction:function(n,t,i,r,u,f,e,o){return wtl.util.showEmailWin(wtl.util._propertyEmailActionUrl(n,t,i,r,u,f,e,o))},emailListing:function(n,t,i,r,u,f){var e="/Popups/SendEmail.aspx?Type=EmailListing&Referrer="+location.pathname.substring(1);r?(e+="&WorkWithAgent="+r,e+="&AgentID="+r):u?(e+="&DirectOfficeSite="+u,e+="&OfficeID="+u):f&&(e+="&DirectCompanySite="+f,e+="&CompanyID="+f);e+=n>0?"&ListingID="+n:"&MLSID="+t+"&MLSProviderID="+i;wtl.util.showEmailWin(e)},showNeighborhood:function(n){wtl.util.showEmailWin("/Popups/NeighborhoodsAndSchools.aspx?PostalCode="+n+"&Type=Demographics")},saveToFavorites:function(n,t,i){if(!this._saveToFavoritesLock){var r={ListingID:n,MLSID:t,MLSProviderID:i},u=this;this._saveToFavoritesLock=$.ajax({type:"POST",url:"/SaveToHomeFile.c?r="+(new Date).valueOf(),data:r,success:$.proxy(function(n){wtl.util._onSaveToFavorites(n,r)},this),error:function(){u._saveToFavoritesLock=null},dataType:"json"});this._saveToFavoritesLock=null}},_onSaveToFavorites:function(n,t){this._saveToFavoritesLock=null;n.showLogin?wtl.util.topic("requestSignIn").publish({callback:function(){wtl.util.saveToFavorites(t.ListingID,t.MLSID,t.MLSProviderID)}}):n.success&&(wtl.alert({message:n.message||"This property has been saved"}),wtl.util.topic("listHub").publish("LISTING_SAVED"),this.item&&(this.item.GuestListingID=n.guestListingID))},screenLeft:function(){return window.screenLeft||window.screenX},screenWidth:function(){return screen.availWidth||screen.width},screenHeight:function(){return screen.availHeight||screen.height},getGeo:function(n){var t=[];return $(n).each(function(){$(this).each(function(){var n=wtl.util.decodePoints(this);$(n).each(function(i){t.push(n[i])})})}),t},getGeoPolygons:function(n){var t=[];return jQuery.each(n,function(n,i){var r=[];jQuery.each(i,function(n,t){var i=[];jQuery.each(t,function(n,t){i.push(google.maps.geometry.encoding.decodePath(t))});r.push(i)});t.push(r)}),t.length==1?t[0][0]:t},decodePoints:function(n){var c=n.length,u=0,f=[],e=0,o=0,i,r,t,s,h;try{while(u<c){r=0;t=0;do i=n.charCodeAt(u++)-63,t|=(i&31)<<r,r+=5;while(i>=32);s=t&1?~(t>>1):t>>1;e+=s;r=0;t=0;do i=n.charCodeAt(u++)-63,t|=(i&31)<<r,r+=5;while(i>=32);h=t&1?~(t>>1):t>>1;o+=h;f.push({lat:e*1e-5,lng:o*1e-5})}}catch(l){}return f},startLocalStorage:function(){if(this._localStorage==null&&typeof Storage!="undefined")try{localStorage.setItem("a",1);localStorage.removeItem("a");this._localStorage=localStorage}catch(n){this._localStorage=!1}return typeof this._localStorage=="object"},setLocalStorage:function(n,t){return this.startLocalStorage()==!1?!1:!n||n.length<1?!1:localStorage.setItem(n,t)},getLocalStorage:function(n){return this.startLocalStorage()==!1?!1:localStorage.getItem(n)},removeLocalStorage:function(n){return this.startLocalStorage()==!1?!1:this._localStorage.removeItem(n)}})