(function(n){n.widget("wtl.TemplatedWidgetBase",{_create:function(){if(this.templatePath){var t=this,i=this._parse;n(this.element).load(this.templatePath,function(){i.call(t)})}else this.template?(this.element.append(this.template),this._parse()):this._parse()},_parse:function(){this._parsePlaceHolders();this._parseElementRecurse(this.element);typeof this.postCreate=="function"&&this.postCreate.call(this)},_parsePlaceHolders:function(){var n=this.element.html(),i=n.match(/\${[a-zA-Z0-9]+}/g),t,r,u;if(i!=null){for(t=0;t<i.length;t++)r=i[t],u=r.replace("${","").replace("}",""),n=n.replace(r,this.options[u]);this.element.html(n)}},_parseElementRecurse:function(t){var i=this;n(t).children().each(function(){i._parseAttachPoint.call(i,this);i._parseAttachEvent.call(i,this);i._parseElementRecurse(this)})},_parseAttachPoint:function(t){var i=n(t).attr("data-attach-point");i&&(this[i]=n(t))},_parseAttachEvent:function(t){var i=this,r=n(t).attr("data-attach-event"),u;r&&(u=r.split("|"),n(u).each(function(){var r=this.split(":"),u=r[0],f=r[1];n(t).on(u,function(n){i[f].call(i,n)})}))}})})(jQuery);$.widget("wtl.ValidationFormBase",$.wtl.TemplatedWidgetBase,{_onKeyDown:function(n){if(n.which==13&&typeof this.onEnter=="function")this.onEnter(n)},_getFormData:function(n){var t={};return $(n).serializeArray().forEach(function(n){t[n.name]=n.value}),t},_disable:function(n){this.disabled=n;this.disabled?this.element.addClass("disabled"):this.element.removeClass("disabled")},_validate:function(){var n=!0;return $(this.element.find("[data-required]").get().reverse()).each(function(){$(this).removeClass("invalid");var t=$(this).val();t||($(this).addClass("invalid"),$(this).focus(),n=!1)}),typeof this.customValidate=="function"&&(n=this.customValidate(n)),n}}),function(n){n.widget("wtl.GoogleMap",n.wtl.TemplatedWidgetBase,{_map:null,options:{zoomLevel:8,center:{lat:0,lng:0},mapOpts:{}},postCreate:function(){var n,t,i;this.mapNode=this.mapNode||this.element;this.options.mapOpts.mapTypeId||(this.options.mapOpts.mapTypeId=google.maps.MapTypeId.ROADMAP);this.options.mapOpts.styles||(this.options.mapOpts.styles=[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]);this.options.mapOpts.zoom=this.options.zoomLevel;this.options.swLat?(t=new google.maps.LatLng(this.options.swLat,this.options.swLng),i=new google.maps.LatLng(this.options.neLat,this.options.neLng),n=new google.maps.LatLngBounds(t,i),this.options.mapOpts.center=n.getCenter()):this.options.mapOpts.center=new google.maps.LatLng(this.options.center.lat,this.options.center.lng);this._map=new google.maps.Map(this.mapNode[0],this.options.mapOpts);n&&this._map.fitBounds(n)}})}(jQuery),function(n){n.widget("wtl.Alert",n.wtl.TemplatedWidgetBase,{template:"<div class='pop-up fixed' gumby-fixed='top'><p>${message}<\/p><div class='medium primary btn'><a href='#' data-attach-event='click:_onDismiss'>${closeButtonText}<\/a><\/div><\/div>",options:{timeout:5e3,fadeoutSpeed:500,closeButtonText:wtl.resources.shared.close},postCreate:function(){this.element.fadeIn();var n=this;setTimeout(function(){n.dismissed||n.remove()},this.options.timeout)},remove:function(){var n=this.element;this.element.fadeOut(this.options.fadeoutSpeed,function(){n.remove()})},_onDismiss:function(n){n.preventDefault();this.dismissed=!0;this.element.trigger("dismiss");this.remove()}});typeof wtl=="undefined"&&(window.wtl={});window.wtl.alert=function(t){var i=document.createElement("div");n(i).hide();n(document.body).append(i);n(i).Alert(t)}}(jQuery),function(n){n.widget("wtl.AuthenticationProviderModal",n.wtl.ValidationFormBase,{_authProviderLogin:function(t){var i,r,u;t.preventDefault();i=n(t.currentTarget).attr("data-click-param");window._wtl_authProviderCallback=n.proxy(this.onLoginResponse,this);r="/AuthenticationProviderHandler.c?r="+(new Date).valueOf()+"&p="+i;this.options.workWithAgent&&(r+="&WorkWithAgent="+this.options.workWithAgent);u="AuthenticationProvider_"+i;wtl.util.showWin(u,r,500,500)},onLoginResponse:function(n){if(this.username.val(""),this.password.val(""),n.Success){var t=wtl.resources.yourAccount.welcomeBack;t&&wtl.alert({message:t+n.Guest.FirstName+"!"});wtl.util.topic("signedIn").publish(n.Guest);this.callback&&this.callback();this.closeSwitch.trigger("gumby.trigger")}else wtl.alert({message:wtl.resources.yourAccount.error.noSignIn}),this.username.focus()}})}(jQuery);$.widget("wtl.AutoComplete",$.ui.autocomplete,{base:$.ui.autocomplete.prototype,options:{autoType:1,minLength:3,maxResults:10,brandedBaseLinkPrefix:"",source:function(n,t){var i=this;$.getJSON(i.options.brandedBaseLinkPrefix+"/AutoCompleteHandler.c?rand="+(new Date).getTime(),{actionType:i.options.autoType,FuzzySearch:n.term},function(n){t($(n.html).slice(0,i.options.maxResults))})}},isNavigating:function(){return this._isNavigating||!1},_create:function(){this.base._create.call(this);this.element.on("autocompleteselect",function(n,t){t&&t.item&&t.item.url?(this._isNavigating=!0,location.href=this.options.brandedBaseLinkPrefix+t.item.url):wtl.util.topic("autcomplete-item-selected-hack").publish(t.item.value)}.bind(this));this.element.keydown(function(n){if(!this.element.prop("readOnly")&&!this.isNavigating()){var t=$.ui.keyCode;switch(n.keyCode){case t.ENTER:case t.NUMPAD_ENTER:this.element.val()&&this.element.trigger("onEnter",n)}}}.bind(this))},_renderMenu:function(n,t){var i=this;$.each(t,function(t,r){$(r).hasClass("Heading")?$(r.outerHTML).appendTo(n):i._renderItemData(n,{label:$(r).text(),value:$(r).text(),url:$(r).attr("data-url")})})},_normalize:function(n){return n}});$.widget("wtl.BlogComment",$.wtl.ValidationFormBase,{postCreate:function(){this.website.focus(function(){$(this).val()||$(this).val("http://")})},onEnter:function(n){n.preventDefault();this.send()},send:function(){this._validate()&&!this.disabled&&(this.disabled=!0,$.ajax("/BlogHandler.c",{cache:!1,dataType:"json",context:this,data:{commenterName:this.name.val(),commenterEmail:this.email.val(),commenterURL:this.website.val(),comment:this.message.val(),postID:this.options.postId,captcha:this.captchaResponse.val()},success:function(n){n.Success?(this.preSubmit.slideToggle(),this.postSubmit.slideToggle()):wtl.alert({message:n.Error})},error:function(n,t,i){wtl.alert({message:i})},complete:function(){this.disabled=!1}}))},preview:function(n){n.preventDefault();this._togglePreview();$.ajax("/BlogHandler.c",{cache:!1,dataType:"json",context:this,data:{actionType:1,comment:this.message.val()},success:function(n){n.Success?this.previewSection.html(n.Comment):wtl.alert({message:n.Error})},error:function(n,t,i){wtl.alert({message:i})}})},edit:function(n){n.preventDefault();this._togglePreview()},_togglePreview:function(){this.editBtn.toggle();this.previewBtn.toggle();this.previewSection.slideToggle();this.form.slideToggle()},customValidate:function(n){return/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(this.email.val())||(this.email.addClass("invalid"),this.email.focus(),n=!1),n},refreshCaptcha:function(n){n.preventDefault();this.captcha.attr("src","/CaptchaImageHandler.c?u="+(new Date).valueOf())},italic:function(n){n.preventDefault();this.tagInsert("[i]","[/i]")},underline:function(n){n.preventDefault();this.tagInsert("[u]","[/u]")},bold:function(n){n.preventDefault();this.tagInsert("[b]","[/b]")},link:function(n){var r,t,i,f;if(n.preventDefault(),r="",t=this.message.get()[0],document.selection&&document.selection.createRange)r=document.selection.createRange().text;else if(t.selectionEnd&&t.selectionEnd-t.selectionStart>0){var e=t.textLength,o=t.selectionStart,u=t.selectionEnd;u<=2&&typeof e!="undefined"&&(u=e);var h=t.value.substring(0,o),s=t.value.substring(o,u),c=t.value.substring(u,e);r=s}(i=prompt("Enter the hyperlink URL","http://"),i&&i!="http://")&&(f=prompt("Enter the title of the link (optional)",r),f||(f=i),this.tagInsert("[url="+i+"]","[/url]",f))},tagInsert:function(n,t,i){var r=this.message.get()[0],u=!1,s,e,o,f,c,h,l,v,a;if(i&&(u=n+i+t),window.getSelection&&(s=window.getSelection())!=!1){e=r.textLength;o=r.selectionStart;f=r.selectionEnd;f<=2&&typeof e!="undefined"&&(f=e);c=r.value.substring(0,o);h=r.value.substring(o,f);l=r.value.substring(f,e);h=u==!1?n+s+t:u;s="";r.value=c+h+l;r.blur();r.focus();return}if(document.selection){s=document.selection.createRange().text;r.focus();document.selection.createRange().text=s?u==!1?n+s+t:u:u==!1?n+t:u;s="";r.blur();r.focus();return}if(!isNaN(r.selectionEnd)){v=r.scrollTop;e=r.textLength;o=r.selectionStart;f=r.selectionEnd;f<=2&&typeof e!="undefined"&&(f=e);c=r.value.substring(0,o);h=r.value.substring(o,f);l=r.value.substring(f,e);u==!1?(a=o+n.length+h.length+t.length,r.value=u==!1?c+n+h+t+l:u):(a=o+u.length,r.value=c+u+l);r.focus();r.selectionStart=a;r.selectionEnd=a;r.scrollTop=v;return}}}),function(n){n.widget("wtl.ForgotPasswordModal",n.wtl.ValidationFormBase,{focus:function(){this.username.focus()},onEnter:function(n){this._sendClick(n)},customValidate:function(n){return/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(this.email.val())||(this.email.addClass("invalid"),this.email.focus(),n=!1),n},_sendClick:function(t){if(t.preventDefault(),this._validate()&&!this.disabled){this._disable(!0);var i={Username:this.username.val(),EmailAddress:this.email.val()};n.ajax("/YourAccountPassword.aspx",{dataType:"json",cache:!1,context:this,data:i,success:function(n){this.username.val("");this.email.val("");n&&n.Success?(n.Message&&wtl.alert({message:n.Message}),this.closeSwitch.trigger("gumby.trigger")):(wtl.alert({message:n.Message||"There was a problem updating your password. Please try again."}),this.username.focus())},error:function(n,t,i){wtl.alert({message:i})},complete:function(){this._disable(!1)}})}}})}(jQuery);$.widget("wtl.GooglePropertyMap",$.wtl.GoogleMap,{options:{lineColor:{r:255,g:125,b:75},mapOpts:{}},postCreate:function(){var n,t,i;$.wtl.GoogleMap.prototype.postCreate.call(this);n=this;this._map.setMapTypeId(google.maps.MapTypeId.HYBRID);google.maps.event.addListenerOnce(this._map,"idle",function(){console.log("Map Idle");n._resizeMap()});t={position:new google.maps.LatLng(n.options.center.lat,n.options.center.lng),map:n._map};i=new google.maps.Marker(t);this.nls=wtl.resources;this.directionsDisplay=new google.maps.DirectionsRenderer;this.directionsService=new google.maps.DirectionsService},_resizeMap:function(){if(console.log("Map Resize, Options =",this.options),this._map){var n=this.options.mapOpts.center;google.maps.event.trigger(this._map,"resize");this._map.setCenter(n);console.log("Map Resized, Center =",n.lat(),n.lng())}},_onDirectionsClick:function(n){n.preventDefault();this.directions.hide();this.notFound.hide();this.directionsForm.slideToggle(100);this.startLocation.focus()},_onDirectionSubmit:function(n){var t,i;wtl.util.topic("listHub").publish("DRIVING_DIRECTIONS_CLICKED");n.preventDefault();t=$("input[name=routeType]:checked").val();this.directions.hide();this.notFound.hide();this.directionsDisplay.setMap(this._map);i=this;this.directionsService.route({origin:this.startLocation.val(),destination:new google.maps.LatLng(this.options.center.lat,this.options.center.lng),travelMode:google.maps.TravelMode[t]},function(n,t){i._onDirectionsResponse(n,t)})},_onDirectionsResponse:function(n,t){var i,r;t==="OK"?(i=n.routes[0],this.via.html(i.summary),r=i.legs[0],this.from.html(r.start_address),this.distance.html(r.distance.text),this.duration.html(r.duration.text),this.directionsWarning.html(i.warnings),this.directionsCopyRight.html(i.copyrights),this.routeSteps.empty(),this._renderSteps(n),this.directionsDisplay.setDirections(n),this.directions.slideDown()):(this.directionsDisplay.setMap(null),this.notFound.show())},_renderSteps:function(n){for(var e=n.routes[0].legs[0],f=0;f<e.steps.length;f++){var i=this.routeStepTemplate.clone(),r=e.steps[f],u="",t=r.maneuver;t||(t=r.instructions);t&&(t.indexOf("Straight")>-1||t.indexOf("straight")>-1?u="wtl-directions-up":t.indexOf("Right")>-1||t.indexOf("right")>-1?u="wtl-directions-right":(t.indexOf("Left")>-1||t.indexOf("left")>-1)&&(u="wtl-directions-left"));i.find(".js-maneuver").addClass(u);i.find(".js-instruction").html(r.instructions);r.travelDuration<60?i.find(".js-duration").hide():i.find("span.js-duration").html(r.duration.text);r.distance.value<.1?i.find(".js-distance").hide():i.find("span.js-distance").html(r.distance.text);this.routeSteps.append(i)}},_onKeyDown:function(n){n.which===13&&this._onDirectionSubmit(n)},_closeDirections:function(n){n.preventDefault();this.directionsForm.slideUp()}});$.widget("wtl.GoogleStreetView",{_streetViewService:null,_streetViewRadiusInMeters:50,_showStreetView:!1,_panorama:null,options:{locationHasStreetView:!1,location:{lat:0,lng:0},hideAddress:!1},_create:function(){this.options.locationHasStreetView?this._showTab():this._checkIfLocationHasStreetView(this._showTab);wtl.util.topic("setGoogleStreetViewVisibility").subscribe($.proxy(this._setVisibility,this))},_setVisibility:function(n){!this._panorama&&n&&this._populate(this);this._panorama&&this._panorama.setVisible(n)},_checkIfLocationHasStreetView:function(n){var t=this,i=this.options.location,r=this._streetViewSvc||(this._streetViewSvc=new google.maps.StreetViewService);r.getPanoramaByLocation(new google.maps.LatLng(i.lat,i.lng),this._streetViewRadiusInMeters,function(i,r){if(r==google.maps.StreetViewStatus.OK){var u={ActionType:0,PropertyID:t.options.propertyId,OfficeID:t.options.officeId,MLSProviderID:t.options.mlsProviderId,MLSID:t.options.mlsId};$.post("/UtilityHandler.c?r="+(new Date).valueOf(),u);n(t)}})},_populate:function(n){var t=new google.maps.StreetViewPanorama(n.element[0],{visible:!0}),i=new google.maps.LatLng(n.options.location.lat,n.options.location.lng);t.setPosition(i);t.setPov({heading:0,pitch:0,zoom:0});t.set("addressControl",n.options.hideAddress?!1:!0);n._panorama=t},_showTab:function(){wtl.util.topic("showPropertyStreetView").publish(!0)}}),function(n){var t=function(){return n(".main-nav-panel .main-nav-panel-body")};t().on("mouseleave",function(i){var r=!n(i.relatedTarget).hasClass("is-panel-dropdown")||!n(i.currentTarget).hasClass("main-nav-panel-body");r&&t().addClass("hidden")});n.widget("wtl.MainNavPanel",n.wtl.TemplatedWidgetBase,{postCreate:function(){this.label.click(function(){var t=n(this).next(),i=t.hasClass("hidden");t.toggleClass("hidden",!i)});n(this.element).on("mouseenter",function(){var i=n(this).children(".main-nav-panel-body").first();t().not(i).addClass("hidden");i.removeClass("hidden")})}})}(jQuery);$.widget("wtl.PostPreview",$.wtl.TemplatedWidgetBase,{template:"<img src='${thumb}' data-attach-point='thumbImg'><div class='post-teaser'><h5><a href='${basePath}${urlSafe}'>${title}<\/a><\/h5><p>${preview}<\/p><ul class='post-details'><li><i class='wtl-tag'><\/i> Tags:  <span data-attach-point='tags'><\/span><\/li><li><i class='wtl-calendar'><\/i> Posted: ${postedDate}<\/li><li><i class='wtl-user'><\/i> By: <a href='${postedByLink}'>${postedBy}<\/a><\/li><\/ul><\/div>",postCreate:function(){this.element.addClass("blog-post");this.options.hasThumb||this.thumbImg.hide();this._renderTags()},_renderTags:function(){for(var t,n=0;n<this.options.tags.length;n++)t=this.options.tags[n],this.tags.append(" <a href='"+this.options.basePath+t.urlSafe+"'>"+t.tag+"<\/a>")}});$.widget("wtl.PropertySearch",$.wtl.TemplatedWidgetBase,{options:{brandedBaseLinkPrefix:""},postCreate:function(){var n=this;n.options.isRental=!1;this.searchBtn.click(function(t){t.preventDefault();n.search.apply(n)});this.searchField.AutoComplete({brandedBaseLinkPrefix:this.options.brandedBaseLinkPrefix});this.element.find("[data-url-param]").keydown(function(t){if(t.which===13){var i=this.searchField.AutoComplete("isNavigating");i||n.search.apply(n)}}.bind(this));this.element.find("[data-url-param='~OptionValue~']").change(function(){var t=$(this).val()==="Status=Rent",i;t!==n.options.isRental&&(n.options.isRental=t,i=t?n.options.rentOpts:n.options.saleOpts,n.element.find("[data-url-param$='Price']").each(function(n,t){t.selectedIndex=0;t.options.length=1;$.each(i,function(n,i){t.options[t.options.length]=new Option(i.label,i.value)})}))})},search:function(){var n=this.options.brandedBaseLinkPrefix+"/Search";this.element.find("[data-url-param]").each(function(){var t=$(this),r=t.is("input[type=text]")||t.is(":checked")||t.is("select"),i;r&&t.val()&&(n+=n.indexOf("?")==-1?"?":"&",i=t.attr("data-url-param"),n+=i==="~OptionValue~"?t.val():i+"="+t.val())});setClobberCookie();location.href=n}});$.widget("wtl.QuickContact",$.wtl.ValidationFormBase,{options:{defaultMessage:"",initialButtonText:"",secondButtonText:"",showExtraFields:!1,requirePhone:!1},postCreate:function(){this.message.blur();this.options.title&&this.title.html(this.options.title);this.options.initialButtonText||(this.options.initialButtonText=this.options.title);this.options.secondButtonText||(this.options.secondButtonText=wtl.resources.popUp.finishAndSend);this.options.requirePhone&&this.phone.attr("data-required","true");this.options.showExtraFields&&this._showExtraFields()},onEnter:function(n){this._onSendClick(n)},togglePlaceholder:function(n){var t=$(n.target),i=$.trim(t.val());i&&i!==t.attr("placeholder")||(n.type.toLowerCase()==="blur"?(t.val(t.attr("placeholder")),t.addClass("placeholder-text")):(t.val(""),t.removeClass("placeholder-text")))},_onSendClick:function(n){n.preventDefault();this.extraFields.is(":visible")?this._send():(this._showExtraFields(),this.firstName.focus())},_showExtraFields:function(){this.extraFields.slideDown(function(){wtl.util.topic("ExpandQuickContact").publish(this.element)}.bind(this));this.buttonText.html(this.options.secondButtonText)},_send:function(){if(this._validate()&&!this.disabled){var n=$.extend({},this.options.sendParams);this.element.find("input[name]").each(function(t,i){n[i.name]=i.value});n.FirstName=this.firstName.val();n.LastName=this.lastName.val();n.Message=this.message.val();n.PhoneNumber=this.phone.val();n.EmailAddress=this.email.val();this._disable(!0);$.ajax("/QuickContact.aspx",{dataType:"json",method:"POST",cache:!1,context:this,data:n,success:function(n){this.options.showExtraFields||(this.extraFields.slideUp(),this.buttonText.html(this.options.initialButtonText));this.element.find("input").val("");this.element.find("textarea").val("");n.Success&&wtl.util.topic("quickContactSuccess").publish();wtl.alert({message:n.Message})},error:function(n,t,i){wtl.alert({message:i})},complete:function(){this._disable(!1)}})}},customValidate:function(n){return/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(this.email.val())||(this.email.addClass("invalid"),this.email.focus(),n=!1),n}});$.widget("wtl.SocialShare",$.wtl.TemplatedWidgetBase,{_socialControls:{google:{url:"https://plus.google.com/share?url="+encodeURIComponent(location.href),listhubEvent:"SHARED_GOOGLE_PLUS",windowHeight:436,windowWidth:626},facebook:{url:"https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(location.href),listhubEvent:"SHARED_FACEBOOK",windowHeight:436,windowWidth:626},twitter:{url:"https://twitter.com/share?text="+$(document).attr("title"),listhubEvent:"SHARED_TWITTER",windowHeight:440,windowWidth:626},linkedin:{url:"http://www.linkedin.com/shareArticle?mini=true&url="+encodeURIComponent(location.href)+"&title="+$(document).attr("title")+"&summary=&source="+encodeURIComponent(location.href),listhubEvent:"SHARED_LINKEDIN",windowHeight:510,windowWidth:850},pinterest:{url:"http://www.pinterest.com/pin/create/button/?url="+encodeURIComponent(location.href)+"&media=~imageUrl~&description="+$(document).attr("title"),listhubEvent:"SHARED_PINTEREST",windowHeight:436,windowWidth:626}},options:{imageUrl:""},postCreate:function(){},_onShare:function(n){n.preventDefault();var i=$(n.target).attr("data-param-social"),t=this._socialControls[i];t&&(wtl.util.topic(i+"LogEvent").publish(),wtl.util.topic("listHub").publish(t.listhubEvent),t.url=t.url.replace("~imageUrl~",this.options.imageUrl),wtl.util.showWin(i+"-share-dialog",t.url,t.windowWidth,t.windowHeight))}}),function(n){n.widget("wtl.ValuationSection",n.wtl.TemplatedWidgetBase,{options:{widgetType:"none"},postCreate:function(){var t=function(){},i=function(){var t=n("#autocomplete").val();return t?(n("#Address").val(t),n("#widgetAndForm").addClass("loading").removeClass("hidden"),t):(alert("You must enter an address"),null)};switch(this.options.widgetType){case"Rpr":t=function(){function o(){f.removeClass("loading");n(".valuation-description").addClass("hidden");clearInterval(e)}var t=i(),r,u,f,e;t&&(r=n("<iframe>",{src:"/RprWidget?Address="+t}),n("body").append(r),u=n("#rprWidgetPlaceholder"),f=n("#widgetAndForm"),e=setInterval(function(){var n=r.contents().find("body");n.find(".rpr-avm-widget").html()&&(u.html(n.html()),o());n.find("div").css("display")==="none"&&(u.html(this.options.sorry.replace("{address}",t)),o())}.bind(this),150))}.bind(this);break;case"None":t=function(){i()&&setTimeout(function(){n("#widgetAndForm").removeClass("loading");n(".valuation-description").addClass("hidden")},2500)}}n("#valuationSection button").click(t)}})}(jQuery);$.widget("wtl.WalkscoreTravelTime",$.wtl.GoogleMap,{_overlayUI:null,_menuUI:null,_mapContainer:null,_polygonXhr:null,_uncongestedPolygon:null,_bounds:null,_geoShape:null,options:{origin:{lat:null,lng:null},menuTopPixelOffset:10,menuRightPixelOffset:10,travelMode:"drive",travelTime:60,markerOptions:{}},postCreate:function(){$.wtl.GoogleMap.prototype.postCreate.call(this);var n={position:new google.maps.LatLng(this.options.center.lat,this.options.center.lng),map:this._map},t=new google.maps.Marker(n);this._retrievePolygonData();this._mapContainer=this.element;this._createOverlayUI();this._overlayUI&&(this._mapContainer.append(this._overlayUI),this._map.controls[google.maps.ControlPosition.RIGHT_TOP].push(this._overlayUI[0]));this._addPoweredBy()},_createOverlayUI:function(){this._overlayUI=$("<div>",{id:"travelTimeOverlayUI",css:{top:this.options.menuTopPixelOffset.toString()+"px",right:this.options.menuRightPixelOffset.toString()+"px"}});this._overlayUI.on("mouseenter",$.proxy(this._showMenuUI,this));this._overlayUI.on("mouseleave",$.proxy(this._hideMenuUI,this));var n=$("<div>",{"class":"overlay"}).appendTo(this._overlayUI);$("<div>",{"class":"preview"}).appendTo(n);$("<div>",{"class":"travel-mode-icon "+this.options.travelMode}).appendTo(n);$("<div>",{"class":"travel-time"}).html(this.options.travelTime.toString()+" Min").appendTo(n);this._overlayUI.append(n);this._createMenuUI();this._overlayUI.append(this._menuUI)},_createMenuUI:function(){this._menuUI=$("<div>",{"class":"menu",css:{top:this.options.menuTopPixelOffset.toString()+"px",right:this.options.menuRightPixelOffset.toString()+"px"}});var n=$("<div>",{"class":"container"});this._menuUI.append(n);n.append(this._createSlider());n.append(this._createTravelModeSelector());this._menuUI.append(n)},_createSlider:function(){var n=$('<div class="slider-legend"><\/div>'),t=$('<div class="slider">').slider({value:this.options.travelTime,min:15,max:60,step:15,slide:$.proxy(this._setTravelTime,this)}).each(function(){for(var r,t=$(this).data().uiSlider.options,u=t.max-t.min,i=t.min;i<=t.max;i=i+t.step)r=$("<label>"+i+"min<\/label>").css("left",(i-t.min)/u*100+"%"),$(n).append(r)});return t.append(n),t},_createTravelModeSelector:function(){var n=$("<div>",{id:"travelModeSelector"});return n.append(this._buildTravelMode("walk")),n.append(this._buildTravelMode("drive")),n.append(this._buildTravelMode("bike")),n.append(this._buildTravelMode("transit",!0)),n},_buildTravelMode:function(n,t){var i=$("<div>",{"class":"icon"}),r;t&&i.css("borderRightWidth","0");$("<input>",{type:"radio",name:"travelMode",id:"travelMode_"+n,value:n,onclick:"return false;"}).appendTo(i);r=$("<label>",{"for":"travelMode_"+n}).appendTo(i);r.on("click",$.proxy(this._travelModeLabelClick,this));return $("<span>",{"class":"travel-mode-icon "+n+(n==this.options.travelMode?" selected":"")}).appendTo(r),i},_retrievePolygonData:function(){this._polygonXhr==null&&(this._uncongestedPolygon=null,this._polygonXhr=$.ajax({url:"/TravelTimeHandler.c?latitude="+this.options.origin.lat+"&longitude="+this.options.origin.lng+"&tt="+this.options.travelTime.toString()+"&tm="+this.options.travelMode+"&congestion=false",headers:{"Content-Type":"application/json"},dataType:"json",context:this,success:$.proxy(this._onPolygonReceived,this),error:$.proxy(function(){this._polygonXhr=null},this)}))},_onPolygonReceived:function(n){this._polygonXhr=null;this._uncongestedPolygon=n.Polygons;this._bounds=n.Boundary;this._uncongestedPolygon!=null&&this._redrawPolygons()},_redrawPolygons:function(){var t,n,i;this._geoShape&&this._geoShape.setMap(null);t=[new google.maps.LatLng(90,-180),new google.maps.LatLng(-90,-180),new google.maps.LatLng(-90,0),new google.maps.LatLng(90,0)];n=[];n.push(t);i=n.concat(this._createMapPolygon(this._uncongestedPolygon));this._geoShape=new google.maps.Polygon({paths:i,fillColor:"#000000",fillOpacity:.58,strokeColor:"#30B100",strokeOpacity:.78,strokeWeight:3});this._geoShape.setMap(this._map);this._adjustMapZoomLevel(this._uncongestedPolygon)},_createMapPolygon:function(n){for(var r,i,u,f=[],t=0;t<n.length;t++){for(r=[],i=0;i<n[t].Coordinates.length;i++)u=n[t].Coordinates[i],r.push(new google.maps.LatLng(u.Latitude,u.Longitude));f.push(r)}return f},_adjustMapZoomLevel:function(n){for(var i,r,u=new google.maps.LatLngBounds,t=0;t<n.length;t++)for(i=0;i<n[t].Coordinates.length;i++)r=n[t].Coordinates[i],u.extend(new google.maps.LatLng(r.Latitude,r.Longitude));this._map.fitBounds(u)},_showMenuUI:function(){this._menuUI.find(".container").hide();this._overlayUI.find(".overlay").hide();this._menuUI.show();this._overlayUI.stop().animate({height:"100px",width:"200px"},400,$.proxy(function(){this._menuUI.find(".container").show()},this))},_hideMenuUI:function(n){for(var t=n.toElement||n.relatedTarget;t&&t.parentNode&&t.parentNode!=window;){if(t.parentNode==n.currentTarget||t==n.currentTarget)return t.preventDefault&&t.preventDefault(),!1;t=t.parentNode}this._menuUI.find(".container").hide();this._overlayUI.stop().animate({height:"76px",width:"82px"},400,$.proxy(function(){this._overlayUI.find(".overlay").show()},this))},_travelModeLabelClick:function(n){return $.proxy(this._setTravelMode($("#"+$(n.currentTarget).attr("for")).val()),this),n.preventDefault(),!1},_setTravelMode:function(n){this.options.travelMode!=n&&(this.options.travelMode=n,this._retrievePolygonData(),this._refreshOverlayUI(),this._refreshMenuUI())},_refreshOverlayUI:function(){$(this._overlayUI).find(".travel-mode-icon").first().attr("class","travel-mode-icon "+this.options.travelMode);var n=$(this._overlayUI).find(".travel-time").first();n&&$(n).html(this.options.travelTime.toString()+" Min")},_refreshMenuUI:function(){$(this._menuUI).find(".travel-mode-icon.selected").each(function(){$(this).removeClass("selected")});var n=$(this._menuUI).find(".travel-mode-icon."+this.options.travelMode).first();$(n).addClass("selected")},_setTravelTime:function(n,t){this.options.travelTime!=t.value&&(this.options.travelTime=t.value,this._retrievePolygonData(),this._refreshOverlayUI())},_addPoweredBy:function(){$(this._mapContainer).after($('<div id="poweredBy"><a href="http://www.walkscore.com" target="_blank">Powered by Walk Score&#174; Travel Time<\/a><\/div>'))}}),function(n){n.widget("wtl.GuestAccountInformationForm",n.wtl.ValidationFormBase,{postCreate:function(){n(this.element).submit(function(t){t.preventDefault();this._validate()&&n.post(this.options.routeUrl,this._getFormData(this.element)).then(function(){wtl.alert({message:wtl.resources.yourAccount.attaBoy})})}.bind(this))},customValidate:function(n){var i;this.Password.val()!=this.ConfirmPassword.val()&&(n=!1,this.Password.addClass("invalid"),this.ConfirmPassword.addClass("invalid"),wtl.alert({message:wtl.resources.yourAccount.error.passwordMatch}));i=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;i.test(this.EmailAddress.val())||(this.EmailAddress.addClass("invalid"),this.EmailAddress.focus(),n=!1);var t=this.PostalCode.val(),r=/^\d{5}(?:[-\s]\d{4})?$/.test(t),u=this.options.postalCodeRequired?!t||!r:t&&!r;return u&&(this.PostalCode.addClass("invalid"),this.PostalCode.focus(),n=!1),n}})}(jQuery),function(n){n.widget("wtl.SavedSearch",n.wtl.TemplatedWidgetBase,{})}(jQuery);$.widget("wtl.GoogleCommunityMap",$.wtl.GoogleMap,{options:{},postCreate:function(){$.wtl.GoogleMap.prototype.postCreate.call(this);var n=new google.maps.Polygon({paths:this.options.encodedPolys,strokeColor:"#EE422A",strokeOpacity:.78,strokeWeight:1,fillColor:"#C6B8AD",fillOpacity:.5});n.setMap(this._map);wtl.util.topic("community-map-resize").subscribe($.proxy(this._resize,this));google.maps.event.addDomListener(window,"resize",function(){this._resize.call(this)}.bind(this))},_resize:function(){var n=this._map.getCenter();google.maps.event.trigger(this._map,"resize");this._map.setCenter(n)}});$.widget("wtl.SlideShowBullets",$.wtl.TemplatedWidgetBase,{postCreate:function(){this.element.addClass("bullets-outer");var n=document.createElement("div");$(n).addClass("bullets");this.element.append(n);this.bullets=$(n)},resetUI:function(n,t){var u,i,r;for(this.icons=[],this.bullets.each(function(n,t){$(t).off("click")}),this.bullets.empty(),u=this,i=0;i<n;i++)r=$(document.createElement("i")),r.addClass("wtl-stop"),this.bullets.append(r),this.icons[i]=$(r),r.click(function(n){return function(){u.options.onClick(n);u.setSelected.call(u,n)}}(i));this.setSelected(t)},setSelected:function(n){this.bullets.children().removeClass("active");this.icons[n].addClass("active")}});$.widget("wtl.SlideShow",$.wtl.TemplatedWidgetBase,{options:{autoPlay:!0,showArrows:!0,childrenPerPageBreakpoints:[],animationSpeed:500,animationInterval:4e3,navType:"bullets",animationType:"fadeOutFlashIn"},postCreate:function(){this.allSlides=this.element.children();this._wrapChildren();this.options.showArrows&&this._createArrows();this._setChildrenPerPage();this._resetUiComponents();this.options.autoPlay&&this.play();var n=this;$(window).resize(function(){n._checkWindowSize.call(n);n.resize.call(n)})},_wrapChildren:function(){this.allSlides.css("min-height","1px").wrapAll("<div class='slider-container'><\/div>");this.slideWrapper=this.element.children().first()},play:function(){if(!this.playInterval){var n=this;this.playInterval=setInterval(function(){!n.isOffScreen.call(n)&&n.pages>1&&n.showNext.call(n)},this.options.animationInterval)}},stop:function(){this.playInterval&&(clearInterval(this.playInterval),this.playInterval=null)},_checkWindowSize:function(){var n=this.childrenPerPage;this._setChildrenPerPage();n!==this.childrenPerPage&&this._resetUiComponents()},_setChildrenPerPage:function(){var t=$(this.options.childrenPerPageBreakpoints),i=this,n=!1;t.each(function(t,r){if(Modernizr.mq(r.mq))return i.childrenPerPage=r.children,n=!0,!1});n||(this.childrenPerPage=1)},_selectSlides:function(n){var t=n*this.childrenPerPage,i=t+this.childrenPerPage;return this.allSlides.slice(t,i)},_createArrows:function(){var t=document.createElement("div"),i=document.createElement("div"),n;$(t).addClass("nav-arrow left");$(i).addClass("nav-arrow right");n=this;$(t).click(function(){n.stop.call(n);n.showPrevious.call(n)});$(i).click(function(){n.stop.call(n);n.showNext.call(n)});this.slideWrapper.append(this._leftArrow=$(t));this.slideWrapper.append(this._rightArrow=$(i))},_resetUiComponents:function(){function u(){this.allSlides.each(function(){$(this).hide()})}var t=this.allSlides.index(this.allSlides.filter(":visible").first()),n,i,r;t!==-1&&(this.pages=Math.ceil(this.allSlides.length/this.childrenPerPage),n=Math.floor(t/this.childrenPerPage),this.options.showArrows&&(this.pages===1?(this._leftArrow.hide(),this._rightArrow.hide()):(this._leftArrow.show(),this._rightArrow.show())),u.call(this),this._createNav(),this.element.trigger("resetUI",[this.pages,n]),this.showSlide(n),i=this.slideWrapper.width(),r=this.slideWrapper.height(),this.aspectRatio=i/r)},_createNav:function(){var f,r,t,n,u,i;this.navNode&&this.navNode.remove();f=document.createElement("div");this.navNode=$(f);this.element.append(this.navNode);r=this;t=$.extend(this.options,{onClick:function(n){r.showSlide.call(r,n)}});switch(this.options.navType){case"bullets":this.navNode.SlideShowBullets(t);n=this.navNode.data("wtl-SlideShowBullets");this.element.on("slideChange",function(t,i){n.setSelected(i-1)});this.element.on("resetUI",function(t,i,r){n.resetUI.call(n,i,r)});break;case"thumbs":for(u=[],i=0;i<this.allSlides.length;i++)u.push($(this.allSlides[i]).find("img").addBack("img").attr("src"));t.images=u;this.navNode.SlideShowThumbs(t);n=this.navNode.data("wtl-SlideShowThumbs");this.element.on("slideChange",function(t,i){n.setSelected(i-1)})}},showNext:function(){var n=this.pageIndex+1;n>=this.pages&&(n=0);this.showSlide(n)},showPrevious:function(){var n=this.pageIndex-1;n<0&&(n=this.pages-1);this.showSlide(n)},showSlide:function(n){this._fadeOutFlashIn(n)},_fadeOutFlashIn:function(n){this._selectSlides(typeof this.pageIndex=="undefined"?n:this.pageIndex).fadeOut(this.options.animationSpeed);this.pageIndex=n;this.element.trigger("slideChange",[n+1,this.allSlides.length]);this._onSlideChange(n);this._selectSlides(this.pageIndex).fadeIn(this.options.animationSpeed);this.resize()},_onSlideChange:function(n){var t=$(this._selectSlides(n)),i,u=t.find("> img:only-child").attr("src"),r,f,e;u?(r=new Image,r.src=u,i=r.naturalHeight>r.naturalWidth?"tall":"wide"):(f=$(window).height()/$(window).width(),e=t.outerHeight()/t.outerWidth(),i=e>f?"tall":"wide");(t.attr("class")||"").split(" ").some(function(n){return n===i})||t.removeClass("wide").removeClass("tall").addClass(i)},resize:function(){if(!this.isFullScreen()){var n=this._selectSlides(this.pageIndex);this.slideWrapper.stop();this.slideWrapper.animate({height:this._getSlidePageHeight(n)},this.options.animationSpeed)}},_getSlidePageHeight:function(n){return n=$(n),n.each(function(){var n='[class*="j-force-"]',t=$(this).find(n).addBack(n),i=function(n){var t=n.attr("class").split(" ").filter(function(n){return n.indexOf("j-force-")===0})[0].replace("j-force-","").split("x"),i=parseInt(t[0],10),r=parseInt(t[1],10);return n.width()/i*r};t.each(function(){var n=$(this);n.height(i(n))})}),n.outerHeight()},isOffScreen:function(){var n=this.element.offset(),i=n.top,r=n.top+this.element.outerHeight(),t=$(window).scrollTop(),u=$(window).height();return t+u<i||t>r},isFullScreen:function(){return $.fullscreen.isFullScreen()}});$.widget("wtl.SlideShowThumbs",$.wtl.TemplatedWidgetBase,{options:{images:[]},postCreate:function(){var t=this,r,u,n,i;for(this.element.addClass("thumbs-outer"),r=document.createElement("div"),u=document.createElement("div"),$(r).addClass("thumbs"),$(u).addClass("thumbs-slide"),this.element.append(r),$(r).append(u),this.thumbs=$(u),this.thumbsContainer=$(r),this.images=[],n=0;n<this.options.images.length;n++)i=document.createElement("img"),typeof this.options.thumbBuilder=="function"?this.options.thumbBuilder.call(this,i,n):$(i).attr("src",this.options.images[n]),this.thumbs.append(i),this.images[n]=$(i),$(i).click(function(n){return function(){t.options.onClick(n);t.setSelected.call(t,n)}}(n)),n==this.options.images.length-1&&$(i).load(function(){t.resize.apply(t)});$(window).resize(function(){t.resize.apply(t)})},resize:function(){$.fullscreen.isFullScreen()?this.thumbsContainer.width($(window).width()):this.thumbsContainer.width(this.element.outerWidth(!0));this.visibleWidth=this.thumbsContainer.innerWidth();this.slideWidth=0;for(var n=0;n<this.images.length;n++)this.slideWidth+=this.images[n].outerWidth(!0);this.rightLimit=this.slideWidth-this.visibleWidth;this.rightLimit>0&&(this.rightLimit=-1*this.rightLimit)},setSelected:function(n){this.resize();this.thumbs.children().removeClass("active");this.images[n].addClass("active");var t=this.getImagePosition(n),i=this.visibleWidth/2-t.width/2-t.left;this.thumbs.stop();this.thumbs.animate({left:Math.max(this.rightLimit,Math.min(0,i))},200)},getImagePosition:function(n){for(var r,i=0,t=0;t<n;t++)i+=this.images[t].outerWidth(!0);return r=this.images[n].outerWidth(!0),{left:i,width:r}}})